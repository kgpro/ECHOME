{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard — EchoMe{% endblock %}

{% block extra_css %}
<style>
/* ===== DASHBOARD UTILITIES (re-use existing vars) ===== */
.dashboard-grid{
    display:flex;
    gap:2rem;
    max-width:var(--max-width);
    margin:7rem auto 3rem;
    padding:0 1.25rem;
}
/* left list area */
.msg-list{
    flex:1 1 70%;
    background:var(--card);
    border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,.06);
    padding:1.5rem;
}
/* right user card */
.user-card{
    flex:0 0 320px;
    background:linear-gradient(135deg, #f3f5ff, #eef2ff);
    border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,.06);
    padding:1.5rem;
    height:fit-content;
}
.user-card h3{
    margin-bottom:1rem;
    color:var(--primary);
}
.user-card .row{
    display:flex;
    justify-content:space-between;
    margin:.5rem 0;
    font-size:.95rem;
}
.user-card .row span:first-child{
    font-weight:600;
    color:var(--muted);
}
.status-pill{
    display:inline-block;
    padding:.25rem .6rem;
    border-radius:999px;
    font-size:.75rem;
    font-weight:600;
    color:#fff;
}
.status-pending{ background:#f59e0b; }
.status-sent   { background:#10b981; }
.status-deleted{ background:#ef4444; }

/* table-like rows */
.msg-row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:.75rem 0;
    border-bottom:1px solid #e5e7eb;
}
.msg-row:last-child{ border:none; }
.msg-info{ flex:1; }
.msg-info .email{ font-weight:600; }
.msg-info .time{ font-size:.85rem; color:var(--muted); }
.msg-actions .btn-sm{
    padding:.35rem .65rem;
    font-size:.8rem;
    border-radius:6px;
}
.btn-danger{
    background:#ef4444;
    color:#fff;
}
</style>
{% endblock %}

{% block content %}
<section class="dashboard-grid">
    <!----------- message list ----------->
    <div class="msg-list card">
        <h2>My Messages</h2>

        {% if messages %}
            {% for msg in messages %}
            <div class="msg-row">
                <div class="msg-info">
                    <div class="email">{{ msg.email }}</div>
                    <div class="time">Delivery ≈ {{ msg.approx_time|date:"M d, Y H:i" }}</div>
                </div>
                <div class="msg-status">
                    <span class="status-pill status-{{ msg.status }}">{{ msg.status|title }}</span>
                </div>
                {% if user_type == 'dev' %}
                <div class="msg-actions">
                    <form method="post" action="{% url 'msg_delete' msg.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button class="btn-sm btn-danger" type="submit"
                                onclick="return confirm('Delete this message?');">Delete</button>
                    </form>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p style="color:var(--muted);">No messages yet.</p>
        {% endif %}
    </div>

    <!----------- user profile card ----------->
    <aside class="user-card card">
        <h3><i class="fas fa-user-circle"></i> Profile</h3>

        <div class="row">
            <span>Email</span>
            <span>{{ user.email }}</span>
        </div>
        <div class="row">
            <span>Full Name</span>
            <span>{{ user.full_name|default:"—" }}</span>
        </div>
        <div class="row">
            <span>Date Joined</span>
            <span>{{ user.created_at|date:"M d, Y" }}</span>
        </div>

        <div class="separator"><span>Actions</span></div>
        <a href="{% url 'accounts:logout' %}" class="btn btn-ghost" style="width:100%;">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </aside>
</section>
{% endblock %}